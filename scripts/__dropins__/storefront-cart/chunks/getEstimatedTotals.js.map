{"version":3,"file":"getEstimatedTotals.js","sources":["../../src/api/getEstimateShipping/graphql/estimateShippingMethodsMutation.ts","../../src/api/getEstimateShipping/graphql/countriesAndRegionsQueries.ts","../../src/api/getEstimateShipping/getEstimateShipping.ts","../../src/api/getEstimatedTotals/graphql/GetEstimatedTotalsMutation.ts","../../src/api/getEstimatedTotals/getEstimatedTotals.ts"],"sourcesContent":["export const ESTIMATE_SHIPPING_METHODS_MUTATION = `\n  mutation ESTIMATE_SHIPPING_METHODS_MUTATION(\n    $cartId: String!\n    $address: EstimateAddressInput!\n  ) {\n    estimateShippingMethods(\n      input: {\n        cart_id: $cartId\n        address: $address\n      }\n    ) {\n      amount {\n        currency\n        value\n      }\n      carrier_code\n      method_code\n      error_message\n      price_excl_tax {\n        currency\n        value\n      }\n      price_incl_tax {\n        currency\n        value\n      }\n    }\n  }\n`;\n","export const COUNTRIES_QUERY = `\nquery COUNTRIES_QUERY {\n  countries {\n    label: full_name_locale\n    id\n  }\n  storeConfig {\n    defaultCountry: default_country\n  }\n}\n`;\n\nexport const REGIONS_QUERY = `\nquery REGIONS_QUERY($id: String) {\n  country(id: $id) {\n    available_regions {\n      code\n\t\t\tname\n    }\n  }\n}\n`;\n\nexport type CountryData = {\n  label: string;\n  id: string;\n  available_regions?: Array<{\n    code: string;\n    name: string;\n  }>;\n  isDefaultCountry?: boolean;\n};\n","import { state } from '@/cart/lib/state';\nimport { fetchGraphQl } from '@/cart/api';\nimport { handleFetchError } from '@/cart/lib/fetch-error';\n\nimport { ESTIMATE_SHIPPING_METHODS_MUTATION } from './graphql/estimateShippingMethodsMutation';\nimport {\n  COUNTRIES_QUERY,\n  CountryData,\n  REGIONS_QUERY,\n} from './graphql/countriesAndRegionsQueries';\n\nexport interface EstimateAddressInput {\n  countryCode: string;\n  postcode?: string;\n  region?: {\n    region?: string;\n    code?: string;\n    id?: number;\n  };\n}\n\nexport const getEstimateShipping = async (\n  address: EstimateAddressInput\n): Promise<any | null> => {\n  const cartId = state.cartId;\n\n  if (!cartId) throw new Error('No cart ID found');\n  if (!address) throw new Error('No address parameter found');\n\n  const { countryCode, postcode, region } = address;\n\n  return fetchGraphQl(ESTIMATE_SHIPPING_METHODS_MUTATION, {\n    variables: {\n      cartId,\n      address: {\n        country_code: countryCode || 'US',\n        postcode: postcode || '',\n        region: {\n          region: region?.region || '',\n          region_code: region?.code || '',\n          region_id: region?.id || 0,\n        },\n      },\n    },\n  }).then(({ errors, data }) => {\n    if (errors) return handleFetchError(errors);\n\n    const estimateShippingMethods: Array<any> = data.estimateShippingMethods;\n\n    if (estimateShippingMethods.length === 0) {\n      return null;\n    }\n    return estimateShippingMethods.find((method) => !method.error_message);\n  });\n};\n\nexport const getCountries = async (): Promise<[CountryData]> => {\n  return fetchGraphQl(COUNTRIES_QUERY, {}).then(({ errors, data }) => {\n    if (errors) return handleFetchError(errors);\n\n    const sortedCountries =\n      data?.countries?.sort((a: any, b: any) =>\n        a.label.localeCompare(b.label)\n      ) || [];\n\n    const defaultCountry = data?.storeConfig?.defaultCountry || 'US';\n\n    // Set the default country property\n    sortedCountries.forEach((country: any) => {\n      country.isDefaultCountry = country.id === defaultCountry;\n    });\n\n    return sortedCountries;\n  });\n};\n\nexport const getRegions = async (\n  countryId: string\n): Promise<Array<{ code: string; name: string }>> => {\n  return fetchGraphQl(REGIONS_QUERY, {\n    variables: {\n      id: countryId,\n    },\n  }).then(({ errors, data }) => {\n    if (errors) return handleFetchError(errors);\n\n    return data?.country?.available_regions || [];\n  });\n};\n","import {\n  CART_FRAGMENT,\n  CART_ITEMS_PAGINATION_ARGUMENTS,\n} from '@/cart/api/graphql/CartFragment';\n\nexport const GET_ESTIMATED_TOTALS_MUTATION = `\n  mutation GET_ESTIMATED_TOTALS_MUTATION(\n    $cartId: String!\n    $address: EstimateAddressInput!,\n    $shipping_method: ShippingMethodInput,\n    ${CART_ITEMS_PAGINATION_ARGUMENTS}\n\n  ) {\n    estimateTotals(\n      input: {\n        cart_id: $cartId\n        address: $address\n        shipping_method: $shipping_method\n      }\n    )  {\n      cart {\n       ...CartFragment\n      }\n    }\n    }\n  ${CART_FRAGMENT}\n  `;\n","import { fetchGraphQl } from '@/cart/api';\nimport { handleFetchError } from '@/cart/lib/fetch-error';\nimport { state } from '@/cart/lib/state';\nimport { CartModel } from '@/cart/data/models';\nimport { transformCart } from '@/cart/data/transforms';\n\nimport { GET_ESTIMATED_TOTALS_MUTATION } from './graphql/GetEstimatedTotalsMutation';\n\nexport interface EstimateAddressShippingInput {\n  countryCode: string;\n  postcode?: string;\n  region?: {\n    region?: string;\n    code?: string;\n    id?: number;\n  };\n  shipping_method?: {\n    carrier_code?: string;\n    method_code?: string;\n  };\n}\n\nexport const getEstimatedTotals = async (\n  address: EstimateAddressShippingInput\n): Promise<CartModel | null> => {\n  const cartId = state.cartId;\n\n  if (!cartId) throw new Error('No cart ID found');\n  if (!address) throw new Error('No address parameter found');\n\n  const { countryCode, postcode, region } = address;\n  const carrier_code = address.shipping_method?.carrier_code;\n  const method_code = address.shipping_method?.method_code;\n\n  return fetchGraphQl(GET_ESTIMATED_TOTALS_MUTATION, {\n    variables: {\n      cartId,\n      address: {\n        country_code: countryCode || 'US',\n        postcode: postcode || '00000',\n        region: {\n          region: region?.region || 'region',\n          region_code: region?.code || 'regionCode',\n          region_id: region?.id || 0,\n        },\n      },\n      shipping_method: {\n        carrier_code: carrier_code || '',\n        method_code: method_code || '',\n      },\n    },\n  }).then(({ errors, data }) => {\n    if (errors) return handleFetchError(errors);\n\n    const estimatedData: { cart: any } = data.estimateTotals;\n\n    if (estimatedData) {\n      const payload = transformCart(estimatedData.cart);\n\n      return payload;\n    }\n\n    return null;\n  });\n};\n"],"names":["ESTIMATE_SHIPPING_METHODS_MUTATION","COUNTRIES_QUERY","REGIONS_QUERY","getEstimateShipping","address","cartId","state","Error","countryCode","postcode","region","fetchGraphQl","variables","country_code","region_code","code","region_id","id","then","errors","data","handleFetchError","estimateShippingMethods","length","find","method","error_message","getCountries","sortedCountries","countries","sort","a","b","label","localeCompare","defaultCountry","storeConfig","forEach","country","isDefaultCountry","getRegions","countryId","available_regions","GET_ESTIMATED_TOTALS_MUTATION","CART_ITEMS_PAGINATION_ARGUMENTS","CART_FRAGMENT","getEstimatedTotals","carrier_code","shipping_method","method_code","estimatedData","estimateTotals","transformCart","cart"],"mappings":"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"}