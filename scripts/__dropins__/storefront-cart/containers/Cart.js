import{useState as y,useEffect as ee,useCallback as ve}from"@dropins/tools/preact-compat.js";import{events as Ie}from"@dropins/tools/event-bus.js";import{Divider as be,PriceSummary as _e,Price as c,Picker as ge,Input as me,Button as ye,CartList as Se,CartItem as Te,Image as he}from"@dropins/tools/components.js";import{E as Ne}from"../chunks/MiniCart.js";import{classes as z,VComponent as ne}from"@dropins/tools/lib.js";import{jsx as r,jsxs as te,Fragment as M}from"@dropins/tools/preact-jsx-runtime.js";import{s as re,m as De,n as Ee}from"../chunks/getStoreConfig.js";import{b as Le,u as Pe}from"../chunks/updateProductsFromCart.js";import{c as Ce,a as we,b as Ue,g as Ge}from"../chunks/getEstimatedTotals.js";import{useText as fe}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const ke=({className:f,children:I,emptyCart:x,heading:h,products:o,priceSummary:v,...n})=>r("div",{...n,className:z(["cart-cart",f]),children:te("div",{className:z(["cart-cart__wrapper"]),children:[h&&te("div",{className:z(["cart-cart__heading",["cart-cart__heading--full-width",!o||!v]]),children:[r(ne,{node:h,className:"cart-cart__heading-text"}),r(be,{variant:"primary",className:z(["cart-cart__heading-divider"])})]}),r("div",{className:z(["cart-cart__content",["cart-cart__content--empty",!o],["cart-cart__content--full-width",!v]]),children:o||r(ne,{node:x,className:"cart-cart__empty-cart"})}),o&&v&&r(ne,{node:v,className:z(["cart-cart__price-summary"])})]})}),Xe=()=>{const[f,I]=y();return{handleEstimateTotals:(h,o)=>{const{shippingCountry:v,shippingState:n="",shippingZip:k=""}=h,B={countryCode:v,postcode:k,region:{region:n},shipping_method:{carrier_code:(o==null?void 0:o.carrier_code)||"",method_code:(o==null?void 0:o.method_code)||""}};Ce(B).then(l=>{var X,S,E,L,P,s,F,C,w,_,U,T,a,d,m,p,i,t,H,O;l&&I({estimatedTaxTotal:{amount:(X=l.totalTax)==null?void 0:X.value,currency:(S=l.totalTax)==null?void 0:S.currency},estimatedSubTotal:{excludingTax:{amount:(L=(E=l.subtotal)==null?void 0:E.excludingTax)==null?void 0:L.value,currency:(s=(P=l.subtotal)==null?void 0:P.excludingTax)==null?void 0:s.currency},includingTax:{amount:(C=(F=l.subtotal)==null?void 0:F.includingTax)==null?void 0:C.value,currency:(_=(w=l.subtotal)==null?void 0:w.includingTax)==null?void 0:_.currency},includingDiscountOnly:{amount:(T=(U=l.subtotal)==null?void 0:U.includingDiscountOnly)==null?void 0:T.value,currency:(d=(a=l.subtotal)==null?void 0:a.includingDiscountOnly)==null?void 0:d.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(m=l.total)==null?void 0:m.includingTax.value,currency:(p=l.total)==null?void 0:p.includingTax.currency},excludingTax:{amount:(i=l.total)==null?void 0:i.excludingTax.value,currency:(t=l.total)==null?void 0:t.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(H=l.appliedTaxes)==null?void 0:H.map(u=>{var N,D;return{label:u.label,amount:{value:(N=u.amount)==null?void 0:N.value,currency:(D=u.amount)==null?void 0:D.currency}}})},estimatedItems:{items:(O=l.items)==null?void 0:O.map(u=>{var N,D,R,Z,$,j,Q,V,q,W;return{uid:u.uid,price:{amount:(N=u.price)==null?void 0:N.value,currency:(D=u.price)==null?void 0:D.currency},taxedPrice:{amount:(R=u.taxedPrice)==null?void 0:R.value,currency:(Z=u.taxedPrice)==null?void 0:Z.currency},rowTotal:{amount:($=u.rowTotal)==null?void 0:$.value,currency:(j=u.rowTotal)==null?void 0:j.currency},rowTotalIncludingTax:{amount:(Q=u.rowTotalIncludingTax)==null?void 0:Q.value,currency:(V=u.rowTotalIncludingTax)==null?void 0:V.currency},regularPrice:{amount:(q=u.regularPrice)==null?void 0:q.value,currency:(W=u.regularPrice)==null?void 0:W.currency}}})}})})},estimatedTotals:f}},Fe=()=>{const[f,I]=y([]),[x,h]=y("US"),[o,v]=y(""),[n,k]=y(""),[B,l]=y([]),[X,S]=y(!1),[E,L]=y(),[P,s]=y(),[F,C]=y(""),[w,_]=y(!1),U=async a=>{const{shippingCountry:d,shippingState:m="",shippingZip:p=""}=a,i={countryCode:d,postcode:p,region:{region:m}};return _(!0),Ge(i).then(t=>(t&&(L({amount:t.amount.value,currency:t.amount.currency,priceIncludingtax:{amount:t.price_incl_tax.value,currency:t.price_incl_tax.currency},priceExcludingtax:{amount:t.price_excl_tax.value,currency:t.price_excl_tax.currency}}),s({carrier_code:t.carrier_code,method_code:t.method_code}),h(d),v(m),k(p),C(m||p||d)),t)).finally(()=>{_(!1)})},T=a=>{a.preventDefault(),v(""),k("");const d=a.target.value;h(d)};return ee(()=>{we().then(a=>{let d="US";const m=a.map(p=>(p.isDefaultCountry&&(d=p.id),{text:p.label,value:p.id}));I(m),h(d)})},[]),ee(()=>{S(!0),Ue(x).then(a=>{const d=a.map(m=>({text:m.name,value:m.code}));l(d)}).finally(()=>{S(!1)})},[x,S]),{loading:w,regionsLoading:X,estimatedDestinationText:F,countries:f,selectedCountry:x,selectedRegion:o,selectedZip:n,regions:B,estimatedShippingPrice:E,estimatedShippingMethod:P,handleEstimateShipping:U,handleCountrySelected:T}},Ae=({children:f,initialData:I=null,routeProduct:x,routeEmptyCartCTA:h,routeCheckout:o,...v})=>{var O,u,N,D,R,Z,$,j,Q,V,q,W,ae,ie,ce;const[n,k]=y(I),[B,l]=y(new Set),{loading:X,countries:S,regions:E,selectedCountry:L,estimatedDestinationText:P,estimatedShippingPrice:s,handleCountrySelected:F,handleEstimateShipping:C,regionsLoading:w,selectedRegion:_,selectedZip:U}=Fe(),{handleEstimateTotals:T,estimatedTotals:a}=Xe(),d=(e,g)=>{l(b=>(e?b.add(g):b.delete(g),new Set(b)))},m=(e,g)=>{d(!0,e),Pe([{uid:e,quantity:g}]).finally(()=>{d(!1,e),P&&p({shippingCountry:L,shippingState:_,shippingZip:U})})},p=ve(e=>{C(e).then(g=>{if(g){const{carrier_code:b,method_code:G}=g;T(e,{carrier_code:b,method_code:G})}else T(e)})},[C,T]),i=fe({applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",checkout:"Cart.PriceSummary.checkout",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",freeShipping:"Cart.PriceSummary.freeShipping",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder",file:"Cart.CartItem.file",files:"Cart.CartItem.files"});ee(()=>{const e=Ie.on("cart/data",g=>{var G,A;k(g);const b=(A=(G=g==null?void 0:g.addresses)==null?void 0:G.shipping)==null?void 0:A[0];if(b){const{countryCode:J,regionCode:K,zipCode:Y}=b;p({shippingCountry:J,shippingState:K,shippingZip:Y})}},{eager:!0});return()=>{e==null||e.off()}},[]),ee(()=>{I&&Object.keys(I).length>0&&Le(I,re.locale||"en-US")},[I]),De().then(e=>{re.config=e});const t=(O=re.config)==null?void 0:O.shoppingCartDisplaySetting,H=(n==null?void 0:n.totalQuantity)??0?r(_e,{"data-testid":"price-summary",loading:X,heading:"Order Summary",total:{price:a!=null&&a.estimatedGrandTotalPrice?r(c,{...a==null?void 0:a.estimatedGrandTotalPrice.includingTax}):r(c,{amount:n==null?void 0:n.total.includingTax.value,currency:n==null?void 0:n.total.includingTax.currency}),estimated:!0,priceWithoutTax:t!=null&&t.grandTotal?a!=null&&a.estimatedAppliedTaxes?r(c,{...a==null?void 0:a.estimatedGrandTotalPrice.excludingTax}):r(c,{amount:n==null?void 0:n.total.excludingTax.value,currency:n==null?void 0:n.total.excludingTax.currency}):void 0},subTotal:{taxIncluded:(t==null?void 0:t.subtotal)==="INCLUDING_TAX"&&!(t!=null&&t.zeroTax),taxExcluded:(t==null?void 0:t.subtotal)==="INCLUDING_EXCLUDING_TAX",zeroTaxSubtotal:t==null?void 0:t.zeroTax,priceExcludingTax:(u=a==null?void 0:a.estimatedSubTotal)!=null&&u.excludingTax?r(c,{"data-testid":"subtotal",...(N=a==null?void 0:a.estimatedSubTotal)==null?void 0:N.excludingTax}):r(c,{"data-testid":"subtotal",amount:(D=n==null?void 0:n.subtotal.excludingTax)==null?void 0:D.value,currency:(R=n==null?void 0:n.subtotal.excludingTax)==null?void 0:R.currency}),price:!(t!=null&&t.zeroTax)&&(t==null?void 0:t.subtotal)==="INCLUDING_TAX"||!(t!=null&&t.zeroTax)&&(t==null?void 0:t.subtotal)==="INCLUDING_EXCLUDING_TAX"?(Z=a==null?void 0:a.estimatedSubTotal)!=null&&Z.includingTax?r(c,{"data-testid":"subtotal",...($=a==null?void 0:a.estimatedSubTotal)==null?void 0:$.includingTax}):r(c,{"data-testid":"subtotal",amount:(j=n==null?void 0:n.subtotal.includingTax)==null?void 0:j.value,currency:(Q=n==null?void 0:n.subtotal.includingTax)==null?void 0:Q.currency}):r(c,{"data-testid":"subtotal",amount:(V=n==null?void 0:n.subtotal.excludingTax)==null?void 0:V.value,currency:(q=n==null?void 0:n.subtotal.excludingTax)==null?void 0:q.currency})},shipping:n!=null&&n.isVirtual?void 0:{taxIncluded:(t==null?void 0:t.shipping)==="INCLUDING_TAX",taxExcluded:(t==null?void 0:t.shipping)==="INCLUDING_EXCLUDING_TAX",price:(s==null?void 0:s.amount)==0?r("span",{"data-testId":"free-shipping",children:i.freeShipping}):(t==null?void 0:t.shipping)==="INCLUDING_TAX"&&s?r(c,{"data-testid":"shipping",...s.priceIncludingtax}):s?r(c,{...s}):r("span",{children:i.taxToBeDetermined}),estimated:!0,priceExcludingTax:s!=null&&s.priceExcludingtax?r(c,{"data-testid":"shipping-excluding-tax",...s.priceExcludingtax}):r("span",{children:i.taxToBeDetermined}),countryField:r(ge,{name:"shippingCountry",placeholder:i.countryField,value:L,variant:"primary",options:S,handleSelect:F,"data-testid":"estimate-shipping-country-selector"}),stateField:E.length>0?r(ge,{name:"shippingState",placeholder:i.stateField,variant:"primary",options:E,value:_,"data-testid":"estimate-shipping-state-selector",disabled:w}):r(me,{"aria-label":i.stateField,name:"shippingState",placeholder:i.stateField,variant:"primary",value:_,disabled:w,"data-testid":"estimate-shipping-state-input",maxLength:50}),zipField:r(me,{"aria-label":i.zipField,name:"shippingZip",placeholder:i.zipField,variant:"primary","data-testid":"estimate-shipping-zip-input",value:U,maxLength:12}),estimateButton:r(ye,{variant:"secondary","data-testid":"estimate-shipping-apply-button","aria-label":i.applyButton,children:i.applyButton}),destinationText:P||i.taxToBeDetermined,onEstimate:p},taxTotal:n!=null&&n.isVirtual?{price:r("span",{"data-testid":"tax-total",children:i.taxToBeDetermined})}:{price:a!=null&&a.estimatedTaxTotal?r(c,{"data-testid":"tax-total",...a==null?void 0:a.estimatedTaxTotal}):n!=null&&n.totalTax?r(c,{"data-testid":"tax-total",amount:(W=n==null?void 0:n.totalTax)==null?void 0:W.value,currency:(ae=n==null?void 0:n.totalTax)==null?void 0:ae.currency}):r("span",{"data-testid":"tax-total",children:i.taxToBeDetermined}),estimated:!0},taxesApplied:n!=null&&n.isVirtual?void 0:t!=null&&t.fullSummary&&(a!=null&&a.estimatedAppliedTaxes)?(ce=(ie=a==null?void 0:a.estimatedAppliedTaxes)==null?void 0:ie.taxes)==null?void 0:ce.map(e=>({label:e.label,price:r(c,{"data-testid":"applied-taxes",amount:e.amount.value,currency:e.amount.currency})})):t!=null&&t.fullSummary?n==null?void 0:n.appliedTaxes.map(e=>({label:e.label,price:r(c,{"data-testid":"applied-taxes",amount:e.amount.value,currency:e.amount.currency})})):void 0,primaryAction:o?r(ye,{"data-testid":"checkout-button",variant:"primary",href:o({cartId:n.id}),children:i.checkout}):void 0,discounts:n==null?void 0:n.appliedDiscounts.map(e=>({label:e.label,price:r(c,{"data-testid":"summary-discount-total",amount:-e.amount.value,currency:e.amount.currency,sale:!0})}))}):void 0;return r(ke,{...v,heading:r("div",{children:i.heading}),emptyCart:r(Ne,{ctaLinkURL:h==null?void 0:h()}),priceSummary:H,products:(n==null?void 0:n.totalQuantity)??0?r(Se,{children:n==null?void 0:n.items.map((e,g)=>{var A,J,K,Y,le,ue,oe,se,de,pe;const b=B.has(e.uid),G={...e.bundleOptions??{},...e.selectedOptions??{},...e.customizableOptions,...e.recipient?{[i.recipient]:e.recipient}:{},...e.recipientEmail&&e.recipient?{[i.recipient]:`${e.recipient} (${e.recipientEmail})`}:{},...e.sender?{[i.sender]:e.sender}:{},...e.senderEmail&&e.sender?{[i.sender]:`${e.sender} (${e.senderEmail})`}:{},...e.message?{[i.message]:e.message}:{},...e.links&&e.links.count?e.links.count>1?{[i.files.replace("{count}",e.links.count.toString())]:e.links.result}:{[i.file.replace("{count}",e.links.count.toString())]:e.links.result}:{}};return r(Te,{ariaLabel:e.name,updating:b,"data-testid":"cart-item",taxIncluded:(t==null?void 0:t.price)==="INCLUDING_TAX",taxExcluded:(t==null?void 0:t.price)==="INCLUDING_EXCLUDING_TAX",image:x?r("a",{href:x(e),children:r(he,{loading:g<4?"eager":"lazy",src:e.image.src,alt:e.image.alt,width:"300",height:"300",params:{width:300}})}):r(he,{loading:g<4?"eager":"lazy",src:e.image.src,alt:e.image.alt,width:"300",height:"300",params:{width:300}}),title:r("span",{children:x?r("a",{href:x(e),children:e.name}):r(M,{children:e.name})}),sku:r("span",{children:e.sku}),configurations:Object.keys(G).length>0?G:void 0,quantity:e.quantity,price:(t==null?void 0:t.price)==="INCLUDING_TAX"?r(c,{amount:e.discounted?(A=e.regularPrice)==null?void 0:A.value:(J=e.taxedPrice)==null?void 0:J.value,currency:e.discounted?(K=e.regularPrice)==null?void 0:K.currency:(Y=e.taxedPrice)==null?void 0:Y.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}):r(c,{amount:(le=e.regularPrice)==null?void 0:le.value,currency:(ue=e.regularPrice)==null?void 0:ue.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}),total:(t==null?void 0:t.price)==="INCLUDING_EXCLUDING_TAX"||(t==null?void 0:t.price)==="INCLUDING_TAX"?r(M,{children:e.discounted?te(M,{children:[r(c,{amount:e.total.value,currency:e.total.currency,variant:e.discounted?"strikethrough":"default","data-testid":"including-tax-row-total","aria-label":i.regularPrice}),r(c,{amount:(oe=e.rowTotalIncludingTax)==null?void 0:oe.value,currency:(se=e.rowTotalIncludingTax)==null?void 0:se.currency,sale:e.discounted,"data-testid":"discount-total","aria-label":i.discountedPrice})]}):r(c,{amount:e.rowTotalIncludingTax.value,currency:e.rowTotalIncludingTax.currency,"data-testid":"including-tax-row-total","aria-label":i.regularPrice})}):te(M,{children:[r(c,{amount:e.total.value,currency:e.total.currency,variant:e.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":i.regularPrice}),e.discounted&&r(c,{amount:(de=e.discountedTotal)==null?void 0:de.value,currency:(pe=e.discountedTotal)==null?void 0:pe.currency,sale:e.discounted,"data-testid":"discount-total","aria-label":i.discountedPrice})]}),totalExcludingTax:(t==null?void 0:t.price)==="INCLUDING_EXCLUDING_TAX"?r(c,{amount:e.rowTotal.value,currency:e.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":i.regularPrice}):void 0,onQuantity:xe=>{m(e.uid,xe)},onRemove:()=>{m(e.uid,0)}},e.uid)})}):void 0})};Ae.getInitialData=async function(){return Ee()};export{Ae as Cart,Ae as default};
//# sourceMappingURL=Cart.js.map
